{% extends "base.html" %}

{% block title %}å²—ä½åŒ¹é…ä¸æŠ€èƒ½è¯Šæ–­æŠ¥å‘Š Â· AI æ±‚èŒçŸ¥è¯†å›¾è°±åŠ©æ‰‹{% endblock %}

{% block head_extra %}
<style>
    :root {
        --primary: #2563eb;
        --primary-hover: #1d4ed8;
        --primary-light: #e0f2fe;
        --secondary: #64748b;
        --success: #10b981;
        --success-light: #ecfdf5;
        --warning: #f59e0b;
        --warning-light: #fffbeb;
        --error: #ef4444;
        --error-light: #fef2f2;
        --background: #f8fafc;
        --surface: #ffffff;
        --border: #e2e8f0;
        --border-light: #f1f5f9;
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --text-tertiary: #94a3b8;
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
        --shadow-md: 0 4px 12px rgba(15, 23, 42, 0.08);
        --shadow-lg: 0 10px 25px rgba(15, 23, 42, 0.1);
        --transition: all 0.3s ease;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        background-color: var(--background);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        color: var(--text-primary);
        line-height: 1.6;
    }

    main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 20px 60px;
    }

    /* ============== é¡µé¢å¤´éƒ¨ ============== */
    .page-header {
        margin-bottom: 32px;
    }

    .step-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(37, 99, 235, 0.08);
        color: var(--primary);
        padding: 8px 16px;
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 16px;
    }

    .step-indicator .step-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        background: var(--primary);
        color: white;
        border-radius: 50%;
        font-size: 12px;
    }

    .page-title {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
        line-height: 1.3;
    }

    .page-subtitle {
        font-size: 16px;
        color: var(--text-secondary);
        max-width: 800px;
    }

    /* ============== ä¸»å†…å®¹å¡ç‰‡ ============== */
    .main-card {
        background: var(--surface);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        padding: 32px;
        margin-top: 16px;
    }

    /* ============== åŒ¹é…åˆ†æ•°å¡ç‰‡ ============== */
    .match-score-card {
        background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
        border: 1px solid #94d2ff;
        border-radius: var(--radius-lg);
        padding: 28px;
        margin-bottom: 28px;
        position: relative;
        overflow: hidden;
    }

    .match-score-card::before {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 150px;
        height: 150px;
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(37, 99, 235, 0) 100%);
        border-radius: 50%;
    }

    .match-score-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 20px;
    }

    .match-score-display {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .score-circle {
        position: relative;
        width: 100px;
        height: 100px;
    }

    .score-circle svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
    }

    .score-circle circle {
        fill: none;
        stroke-width: 8;
        stroke-linecap: round;
    }

    .score-circle-bg {
        stroke: #e2e8f0;
    }

    .score-circle-fill {
        stroke: var(--primary);
        stroke-dasharray: 283;
        stroke-dashoffset: calc(283 - (283 * {{ match_result.match_score if match_result and not match_result.error else 0 }}) / 100);
        transition: stroke-dashoffset 1s ease;
    }

    .score-circle-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .score-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        line-height: 1;
    }

    .score-label {
        font-size: 14px;
        color: var(--text-tertiary);
        margin-top: 4px;
    }

    .match-level-badge {
        display: inline-flex;
        align-items: center;
        padding: 8px 20px;
        border-radius: 30px;
        font-size: 16px;
        font-weight: 600;
        background: white;
        box-shadow: var(--shadow-md);
    }

    .match-level-badge.excellent {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
        border: 1px solid #a7f3d0;
    }

    .match-level-badge.good {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: #92400e;
        border: 1px solid #fde68a;
    }

    .match-level-badge.fair {
        background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
        color: #c2410c;
        border: 1px solid #fdba74;
    }

    .match-level-badge.poor {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #b91c1c;
        border: 1px solid #fecaca;
    }

    .match-summary {
        font-size: 16px;
        color: var(--text-secondary);
        line-height: 1.7;
        margin-bottom: 20px;
        padding-right: 20px;
    }

    .match-summary emoji {
        font-size: 18px;
        margin-right: 6px;
    }

    .action-buttons {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 20px;
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        gap: 8px;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .btn-secondary {
        background: white;
        color: var(--text-secondary);
        border: 1px solid var(--border);
    }

    .btn-secondary:hover {
        background: #f8fafc;
        border-color: var(--text-tertiary);
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
    }

    /* ============== æŠ€èƒ½å±•ç¤ºåŒºåŸŸ ============== */
    .skills-section {
        margin-bottom: 28px;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    .section-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        background: rgba(37, 99, 235, 0.1);
        color: var(--primary);
        border-radius: 10px;
        font-size: 16px;
    }

    .section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
    }

    .section-subtitle {
        font-size: 14px;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    .skills-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 20px;
    }

    .skills-empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        text-align: center;
        color: var(--text-tertiary);
    }

    .skills-empty-state .icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.6;
    }

    .skills-empty-state .text {
        font-size: 14px;
        margin-bottom: 20px;
    }

    .skills-empty-state .link {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
    }

    .skills-empty-state .link:hover {
        text-decoration: underline;
    }

    .skills-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        min-height: 24px;
    }

    .skill-tag {
        display: inline-flex;
        align-items: center;
        padding: 6px 14px;
        background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
        color: #1e40af;
        border-radius: var(--radius-md);
        font-size: 13px;
        font-weight: 500;
        border: 1px solid rgba(147, 197, 253, 0.5);
        transition: var(--transition);
    }

    .skill-tag:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(37, 99, 235, 0.15);
        border-color: #93c5fd;
    }

    /* ============== å²—ä½é€‰æ‹©åŒºåŸŸ ============== */
    .job-select-section {
        margin-bottom: 28px;
    }

    .job-select-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 20px;
    }

    .job-select-form {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        align-items: flex-end;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .form-label {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-secondary);
    }

    .form-select {
        padding: 12px 16px;
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        font-size: 15px;
        color: var(--text-primary);
        background: white;
        transition: var(--transition);
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 16px center;
        background-size: 16px;
        padding-right: 40px;
    }

    .form-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }

    .form-select:disabled {
        background-color: #f8fafc;
        color: var(--text-tertiary);
        cursor: not-allowed;
    }

    .form-select option {
        padding: 8px;
    }

    /* ============== åŒ¹é…è¯¦æƒ…åŒºåŸŸ ============== */
    .match-details-section {
        margin-bottom: 28px;
    }

    .match-details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    @media (max-width: 768px) {
        .match-details-grid {
            grid-template-columns: 1fr;
        }
    }

    .match-detail-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 20px;
        height: 100%;
    }

    .match-detail-card.owned {
        border-top: 4px solid var(--success);
    }

    .match-detail-card.missing {
        border-top: 4px solid var(--warning);
    }

    .match-detail-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 16px;
    }

    .match-detail-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        font-size: 16px;
    }

    .match-detail-icon.owned {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .match-detail-icon.missing {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
    }

    .match-detail-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
    }

    .match-detail-count {
        font-size: 14px;
        color: var(--text-secondary);
        margin-left: 8px;
    }

    .match-detail-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        max-height: 180px;
        overflow-y: auto;
        padding-right: 8px;
    }

    .match-detail-list::-webkit-scrollbar {
        width: 4px;
    }

    .match-detail-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .match-detail-list::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
    }

    .match-detail-item {
        padding: 6px 12px;
        border-radius: var(--radius-md);
        font-size: 13px;
        font-weight: 500;
    }

    .match-detail-item.owned {
        background: rgba(16, 185, 129, 0.1);
        color: #065f46;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .match-detail-item.missing {
        background: rgba(245, 158, 11, 0.1);
        color: #92400e;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }

    /* ============== å›¾è¡¨å’Œå»ºè®®åŒºåŸŸ ============== */
    .analysis-section {
        margin-bottom: 28px;
    }

    .analysis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    @media (max-width: 1024px) {
        .analysis-grid {
            grid-template-columns: 1fr;
        }
    }

    .analysis-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 24px;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .analysis-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
    }

    .analysis-card-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: rgba(37, 99, 235, 0.1);
        color: var(--primary);
        border-radius: 10px;
        font-size: 18px;
    }

    .analysis-card-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
    }

    .analysis-card-subtitle {
        font-size: 14px;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    /* é›·è¾¾å›¾å®¹å™¨ */
    .radar-container {
        flex: 1;
        min-height: 350px;
        position: relative;
    }

    #radarChart {
        width: 100%;
        height: 100%;
    }

    .radar-empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--text-tertiary);
        text-align: center;
        padding: 20px;
    }

    .radar-empty-state .icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.6;
    }

    .radar-empty-state .text {
        font-size: 14px;
        line-height: 1.6;
    }

    /* AIå»ºè®®å®¹å™¨ */
    .ai-suggestion-container {
        flex: 1;
        overflow-y: auto;
        padding-right: 8px;
    }

    .ai-suggestion-container::-webkit-scrollbar {
        width: 4px;
    }

    .ai-suggestion-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .ai-suggestion-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
    }

    .ai-suggestion-content {
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.7;
    }

    .ai-suggestion-content p {
        margin-bottom: 16px;
    }

    .ai-suggestion-content ul, .ai-suggestion-content ol {
        margin-left: 20px;
        margin-bottom: 16px;
    }

    .ai-suggestion-content li {
        margin-bottom: 8px;
    }

    .ai-suggestion-content strong {
        color: var(--text-primary);
        font-weight: 600;
    }

    .ai-suggestion-empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--text-tertiary);
        text-align: center;
        padding: 20px;
    }

    .ai-suggestion-empty-state .icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.6;
    }

    .ai-suggestion-empty-state .text {
        font-size: 14px;
        line-height: 1.6;
    }

    /* ============== é”™è¯¯çŠ¶æ€ ============== */
    .error-card {
        background: linear-gradient(135deg, #fff5f5 0%, #fee2e2 100%);
        border: 1px solid #fecaca;
        border-radius: var(--radius-lg);
        padding: 20px;
        margin-bottom: 28px;
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .error-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: white;
        color: var(--error);
        border-radius: 10px;
        font-size: 20px;
        flex-shrink: 0;
    }

    .error-message {
        font-size: 14px;
        color: #b91c1c;
        line-height: 1.6;
    }

    /* ============== å“åº”å¼è°ƒæ•´ ============== */
    @media (max-width: 768px) {
        main {
            padding: 16px 16px 40px;
        }

        .page-title {
            font-size: 26px;
        }

        .main-card {
            padding: 24px 20px;
        }

        .match-score-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .match-score-display {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .job-select-form {
            grid-template-columns: 1fr;
        }

        .action-buttons {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .page-title {
            font-size: 22px;
        }

        .main-card {
            padding: 20px 16px;
        }

        .match-score-card {
            padding: 20px;
        }

        .score-circle {
            width: 80px;
            height: 80px;
        }

        .score-value {
            font-size: 24px;
        }

        .analysis-card {
            padding: 20px 16px;
        }
    }
</style>
{% endblock %}

{% block content %}
<main>
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
        <div class="step-indicator">
            <div class="step-number">3</div>
            <span>å²—ä½åŒ¹é…ä¸æŠ€èƒ½è¯Šæ–­</span>
        </div>

        <h1 class="page-title">èŒä¸šåŒ¹é…è¯Šæ–­æŠ¥å‘Š</h1>
        <p class="page-subtitle">
            åŸºäºçŸ¥è¯†å›¾è°±çš„æ™ºèƒ½åŒ¹é…åˆ†æï¼Œä¸ºä½ ç”Ÿæˆä¸ªæ€§åŒ–çš„èŒä¸šæå‡æ–¹æ¡ˆä¸æŠ€èƒ½å‘å±•è·¯å¾„ã€‚
        </p>
    </div>

    <!-- ä¸»å†…å®¹å¡ç‰‡ -->
    <div class="main-card">
        <!-- åŒ¹é…åˆ†æ•°å¡ç‰‡ -->
        <div class="match-score-card">
            <div class="match-score-header">
                <div class="match-score-display">
                    <div class="score-circle">
                        <svg viewBox="0 0 100 100">
                            <circle class="score-circle-bg" cx="50" cy="50" r="45"></circle>
                            <circle class="score-circle-fill" cx="50" cy="50" r="45"></circle>
                        </svg>
                        <div class="score-circle-text">
                            <div class="score-value">
                                {% if match_result and not match_result.error %}
                                    {{ match_result.match_score }}
                                {% else %}
                                    0
                                {% endif %}
                            </div>
                            <div class="score-label">åŒ¹é…å¾—åˆ†</div>
                        </div>
                    </div>

                    <div>
                        <div style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 8px;">åŒ¹é…ç­‰çº§</div>
                        {% if match_result and not match_result.error %}
                            <div class="match-level-badge {{ 'excellent' if match_result.match_level == 'ä¼˜ç§€åŒ¹é…' else 'good' if match_result.match_level == 'è‰¯å¥½åŒ¹é…' else 'fair' if match_result.match_level == 'ä¸€èˆ¬åŒ¹é…' else 'poor' }}">
                                {{ match_result.match_level }}
                            </div>
                        {% else %}
                            <div class="match-level-badge" style="background: #f1f5f9; color: var(--text-tertiary); border: 1px solid #e2e8f0;">
                                æœªè¯„ä¼°
                            </div>
                        {% endif %}
                    </div>
                </div>

                {% if match_result and not match_result.error %}
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="exportReport()">
                            <span class="icon">ğŸ“‹</span>
                            å¯¼å‡ºè¯Šæ–­æŠ¥å‘Š
                        </button>
                    </div>
                {% endif %}
            </div>

            {% if match_result and not match_result.error %}
                <div class="match-summary">
                    {% if match_result.competition_summary %}
                        <emoji>ğŸ“Š</emoji> {{ match_result.competition_summary }}
                    {% else %}
                        {% if match_result.match_score >= 80 %}
                            <emoji>âœ…</emoji> æ­å–œï¼ä½ å·²å…·å¤‡è¯¥å²—ä½çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œç«äº‰åŠ›å¤„äºä¸Šæ¸¸æ°´å¹³ï¼Œå»ºè®®ç›´æ¥æŠ•é€’ç®€å†ï¼
                        {% elif match_result.match_score >= 60 %}
                            <emoji>âš ï¸</emoji> ä½ å·²å…·å¤‡è¯¥å²—ä½çº¦{{ match_result.match_score }}%çš„æ ¸å¿ƒæŠ€èƒ½ï¼ŒçŸ­æœŸè¡¥å……{{ [2, match_result.missing_skills|length]|min }}é¡¹æŠ€èƒ½å¯å¤§å¹…æå‡ç«äº‰åŠ›ã€‚
                        {% elif match_result.match_score >= 40 %}
                            <emoji>ğŸ“š</emoji> ä½ å½“å‰åŒ¹é…åº¦{{ match_result.match_score }}%ï¼Œå»ºè®®ä¼˜å…ˆå­¦ä¹ {{ match_result.missing_skills[:2]|join('ã€') if match_result.missing_skills and match_result.missing_skills|length > 0 else 'æ ¸å¿ƒæŠ€èƒ½' }}ç­‰æ ¸å¿ƒæŠ€èƒ½ã€‚
                        {% else %}
                            <emoji>ğŸ”§</emoji> ä½ å½“å‰æŠ€èƒ½åŒ¹é…åº¦è¾ƒä½ï¼Œéœ€ç³»ç»Ÿå­¦ä¹ {{ match_result.missing_skills[:3]|join('ã€') if match_result.missing_skills and match_result.missing_skills|length > 0 else 'å…³é”®æŠ€èƒ½' }}ç­‰å…³é”®æŠ€èƒ½ã€‚
                        {% endif %}
                    {% endif %}
                </div>
            {% else %}
                <div class="match-summary">
                    <emoji>ğŸ”</emoji> é€‰æ‹©ç›®æ ‡å²—ä½å¹¶ç”ŸæˆæŠ¥å‘Šåï¼Œå°†æ˜¾ç¤ºè¯¦ç»†çš„åŒ¹é…åˆ†æå’Œæå‡å»ºè®®ã€‚
                </div>
            {% endif %}
        </div>

        <!-- é”™è¯¯æç¤º -->
        {% if match_result and match_result.error %}
            <div class="error-card">
                <div class="error-icon">âš ï¸</div>
                <div class="error-message">{{ match_result.error }}</div>
            </div>
        {% endif %}

        <!-- æŠ€èƒ½å±•ç¤ºåŒºåŸŸ -->
        <div class="skills-section">
            <div class="section-header">
                <div class="section-icon">ğŸ‘¤</div>
                <div>
                    <div class="section-title">ä¸ªäººæŠ€èƒ½ç”»åƒ</div>
                    <div class="section-subtitle">åŸºäºä½ çš„ç®€å†è§£æç»“æœ</div>
                </div>
            </div>

            <div class="skills-card">
                {% if user_existing_skills and user_existing_skills|length > 0 %}
                    <div class="skills-tags">
                        {% for skill in user_existing_skills %}
                            {% if skill %}
                                <span class="skill-tag">{{ skill }}</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="skills-empty-state">
                        <div class="icon">ğŸ“„</div>
                        <div class="text">å°šæœªç”Ÿæˆä¸ªäººæŠ€èƒ½ç”»åƒ</div>
                        <a href="{{ url_for('resume_kg_page') }}" class="link">å‰å¾€ç®€å†è§£æé¡µé¢ â†’</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- å²—ä½é€‰æ‹©åŒºåŸŸ -->
        <div class="job-select-section">
            <div class="section-header">
                <div class="section-icon">ğŸ¯</div>
                <div>
                    <div class="section-title">é€‰æ‹©ç›®æ ‡å²—ä½</div>
                    <div class="section-subtitle">é€‰æ‹©è¦åŒ¹é…åˆ†æçš„ç›®æ ‡å²—ä½</div>
                </div>
            </div>

            <div class="job-select-card">
                <form method="POST" action="{{ url_for('match_diag_page') }}"
                      onsubmit="document.getElementById('submitBtn').disabled=true;document.getElementById('submitBtn').innerHTML='<span class=\'icon\'>â³</span> è®¡ç®—ä¸­...';">
                    <div class="job-select-form">
                        <div class="form-group">
                            <label class="form-label">ç›®æ ‡å²—ä½</label>
                            <select name="target_job_id" class="form-select" required
                                    {% if not user_existing_skills or user_existing_skills|length == 0 %}disabled{% endif %}>
                                <option value="">è¯·é€‰æ‹©ä¸€ä¸ªå²—ä½...</option>
                                {% for job in all_jobs %}
                                    <option value="{{ job.id }}"
                                            {% if job.id == selected_job_id %}selected{% endif %}>
                                        {{ job.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <button id="submitBtn" type="submit" class="btn btn-primary"
                                {% if not user_existing_skills or user_existing_skills|length == 0 %}disabled{% endif %}>
                            <span class="icon">ğŸ”</span>
                            ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
                        </button>
                    </div>

                    {% if not user_existing_skills or user_existing_skills|length == 0 %}
                        <div style="margin-top: 12px; font-size: 13px; color: var(--text-tertiary);">
                            âš ï¸ è¯·å…ˆå‰å¾€<a href="{{ url_for('resume_kg_page') }}" style="color: var(--primary);">ç®€å†è§£æé¡µé¢</a>ç”Ÿæˆä¸ªäººæŠ€èƒ½ç”»åƒ
                        </div>
                    {% endif %}
                </form>
            </div>
        </div>

        <!-- åŒ¹é…è¯¦æƒ…åŒºåŸŸ -->
        {% if match_result and not match_result.error %}
            <div class="match-details-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ“Š</div>
                    <div>
                        <div class="section-title">åŒ¹é…è¯¦æƒ…æ‹†è§£</div>
                        <div class="section-subtitle">æŠ€èƒ½åŒ¹é…çš„è¯¦ç»†åˆ†æ</div>
                    </div>
                </div>

                <div class="match-details-grid">
                    <!-- å·²å…·å¤‡æŠ€èƒ½ -->
                    <div class="match-detail-card owned">
                        <div class="match-detail-header">
                            <div class="match-detail-icon owned">âœ…</div>
                            <div class="match-detail-title">
                                å·²å…·å¤‡æ ¸å¿ƒæŠ€èƒ½
                                <span class="match-detail-count">({{ match_result.owned_skills|length if match_result.owned_skills else 0 }})</span>
                            </div>
                        </div>

                        <div class="match-detail-list">
                            {% if match_result.owned_skills and match_result.owned_skills|length > 0 %}
                                {% for skill in match_result.owned_skills %}
                                    {% if skill %}
                                        <div class="match-detail-item owned">{{ skill }}</div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <div style="color: var(--text-tertiary); font-size: 14px; padding: 8px;">
                                    æš‚æ— å·²å…·å¤‡çš„æ ¸å¿ƒæŠ€èƒ½
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- å¾…è¡¥å……æŠ€èƒ½ -->
                    <div class="match-detail-card missing">
                        <div class="match-detail-header">
                            <div class="match-detail-icon missing">âš ï¸</div>
                            <div class="match-detail-title">
                                å¾…è¡¥å……æŠ€èƒ½
                                <span class="match-detail-count">({{ match_result.missing_skills|length if match_result.missing_skills else 0 }})</span>
                            </div>
                        </div>

                        <div class="match-detail-list">
                            {% if match_result.missing_skills and match_result.missing_skills|length > 0 %}
                                {% for skill in match_result.missing_skills %}
                                    {% if skill %}
                                        <div class="match-detail-item missing">{{ skill }}</div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <div style="color: var(--text-tertiary); font-size: 14px; padding: 8px;">
                                    æ­å–œï¼å·²æŒæ¡æ‰€æœ‰æ ¸å¿ƒæŠ€èƒ½
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- å›¾è¡¨å’Œå»ºè®®åŒºåŸŸ -->
        <div class="analysis-section">
            <div class="section-header">
                <div class="section-icon">ğŸ“ˆ</div>
                <div>
                    <div class="section-title">æ·±åº¦åˆ†æä¸å»ºè®®</div>
                    <div class="section-subtitle">å¯è§†åŒ–åˆ†æä¸AIä¸ªæ€§åŒ–å»ºè®®</div>
                </div>
            </div>

            <div class="analysis-grid">
                <!-- é›·è¾¾å›¾å¡ç‰‡ -->
                <div class="analysis-card">
                    <div class="analysis-card-header">
                        <div class="analysis-card-icon">ğŸ“Š</div>
                        <div>
                            <div class="analysis-card-title">æŠ€èƒ½åŒ¹é…é›·è¾¾å›¾</div>
                            <div class="analysis-card-subtitle">å²—ä½éœ€æ±‚ä¸ä¸ªäººæŒæ¡çš„å¯¹æ¯”åˆ†æ</div>
                        </div>
                    </div>

                    <div class="radar-container">
                        {% if radar_data and radar_data.dimensions and radar_data.dimensions|length > 0 %}
                            <div id="radarChart"></div>
                        {% else %}
                            <div class="radar-empty-state">
                                <div class="icon">ğŸ“ˆ</div>
                                <div class="text">
                                    {% if match_result and not match_result.error %}
                                        æŠ€èƒ½åŒ¹é…æ•°æ®ä¸è¶³ï¼Œ<br>æ— æ³•ç”Ÿæˆé›·è¾¾å›¾
                                    {% else %}
                                        ç”ŸæˆæŠ¥å‘Šåï¼Œå°†å±•ç¤ºä½ çš„æŠ€èƒ½<br>
                                        ä¸å²—ä½éœ€æ±‚çš„åŒ¹é…é›·è¾¾å›¾
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- AIå»ºè®®å¡ç‰‡ -->
                <div class="analysis-card">
                    <div class="analysis-card-header">
                        <div class="analysis-card-icon">ğŸ¤–</div>
                        <div>
                            <div class="analysis-card-title">AIèŒä¸šæå‡å»ºè®®</div>
                            <div class="analysis-card-subtitle">åŸºäºåŒ¹é…ç»“æœçš„ä¸ªæ€§åŒ–å»ºè®®</div>
                        </div>
                    </div>

                    <div class="ai-suggestion-container">
                        {% if match_result and not match_result.error %}
                            {% if llm_report %}
                                <div class="ai-suggestion-content">
                                    {{ llm_report|safe }}
                                </div>
                            {% else %}
                                <div class="ai-suggestion-empty-state">
                                    <div class="icon">â³</div>
                                    <div class="text">
                                        AIæ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®...<br>
                                        è¯·ç¨ç­‰ç‰‡åˆ»
                                    </div>
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="ai-suggestion-empty-state">
                                <div class="icon">ğŸ¤–</div>
                                <div class="text">
                                    ç”ŸæˆæŠ¥å‘Šåï¼ŒAIå°†ä¸ºä½ æä¾›<br>
                                    ä¸ªæ€§åŒ–çš„æŠ€èƒ½æå‡å»ºè®®
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
<script>
// å¯¼å‡ºè¯Šæ–­æŠ¥å‘Š
function exportReport() {
    {% if match_result and not match_result.error %}
    // å®‰å…¨åœ°è·å–æŠ€èƒ½åˆ—è¡¨
    function safeGetSkills(skills) {
        if (!skills) return [];
        return skills.filter(skill => skill && skill.trim());
    }

    // å®šä¹‰æ€»ç»“æ–‡æœ¬
    let summaryText = "";
    const matchScore = {{ match_result.match_score }};
    const ownedSkillsCount = {{ match_result.owned_skills|length if match_result.owned_skills else 0 }};
    const missingSkillsCount = {{ match_result.missing_skills|length if match_result.missing_skills else 0 }};

    if (matchScore >= 80) {
        summaryText = "âœ… æ­å–œï¼ä½ å·²å…·å¤‡è¯¥å²—ä½çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œç«äº‰åŠ›å¤„äºä¸Šæ¸¸æ°´å¹³ï¼Œå»ºè®®ç›´æ¥æŠ•é€’ç®€å†ï¼";
    } else if (matchScore >= 60) {
        summaryText = "âš ï¸ ä½ å·²å…·å¤‡è¯¥å²—ä½çº¦" + matchScore + "%çš„æ ¸å¿ƒæŠ€èƒ½ï¼ŒçŸ­æœŸè¡¥å……" + Math.min(2, missingSkillsCount) + "é¡¹æŠ€èƒ½å¯å¤§å¹…æå‡ç«äº‰åŠ›ã€‚";
    } else {
        summaryText = "ğŸ”§ ä½ å½“å‰æŠ€èƒ½åŒ¹é…åº¦è¾ƒä½ï¼Œéœ€ç³»ç»Ÿå­¦ä¹ æ ¸å¿ƒæŠ€èƒ½ä»¥æå‡ç«äº‰åŠ›ã€‚";
    }

    // å®šä¹‰æŠ€èƒ½æ–‡æœ¬
    const ownedSkillsText = ownedSkillsCount > 0 ? "{{ match_result.owned_skills|join('ã€')|safe if match_result.owned_skills else 'æ— ' }}" : "æ— ";
    const missingSkillsText = missingSkillsCount > 0 ? "{{ match_result.missing_skills|join('ã€')|safe if match_result.missing_skills else 'æ— ' }}" : "æ— ";
    const llmReportText = `{% if llm_report %}{{ llm_report|replace('<br>', '\n')|replace('"', '\\"')|safe }}{% else %}æš‚æ— AIåˆ†ææŠ¥å‘Š{% endif %}`;
    const competitionSummary = "{{ match_result.competition_summary|default('')|replace('\n', ' ')|replace('"', '\\"') }}";

    // æ‹¼æ¥æŠ¥å‘Šå†…å®¹
    const reportContent = `# å²—ä½åŒ¹é…è¯Šæ–­æŠ¥å‘Š
## ğŸ“Š åŸºæœ¬ä¿¡æ¯
- **ç›®æ ‡å²—ä½**ï¼š{{ match_result.job_name }}
- **åŒ¹é…å¾—åˆ†**ï¼š${matchScore}%
- **åŒ¹é…ç­‰çº§**ï¼š{{ match_result.match_level }}
- **ç”Ÿæˆæ—¶é—´**ï¼š${new Date().toLocaleString('zh-CN')}

## ğŸ¯ æ ¸å¿ƒæ€»ç»“
${competitionSummary || summaryText}

## ğŸ“‹ æŠ€èƒ½åŒ¹é…åˆ†æ
### âœ… å·²å…·å¤‡æ ¸å¿ƒæŠ€èƒ½ï¼ˆ${ownedSkillsCount}é¡¹ï¼‰
${ownedSkillsText}

### âš ï¸ å¾…è¡¥å……æŠ€èƒ½ï¼ˆ${missingSkillsCount}é¡¹ï¼‰
${missingSkillsText}

## ğŸ§  AI ä¸“å±æå‡å»ºè®®
${llmReportText}

---
*æŠ¥å‘Šç”Ÿæˆï¼šAI æ±‚èŒçŸ¥è¯†å›¾è°±åŠ©æ‰‹*
*æ•°æ®æ¥æºï¼šåŸºäºçŸ¥è¯†å›¾è°±çš„æ™ºèƒ½åŒ¹é…åˆ†æ*`;

    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    navigator.clipboard.writeText(reportContent).then(() => {
        showNotification('âœ… è¯Šæ–­æŠ¥å‘Šå·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\nå¯ç²˜è´´åˆ°Notion/Word/å¾®ä¿¡ç­‰å¹³å°æŸ¥çœ‹', 'success');
    }).catch(err => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        showNotification('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æŠ¥å‘Šå†…å®¹', 'error');
        prompt('è¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹æŠ¥å‘Šå†…å®¹ï¼š', reportContent);
    });
    {% else %}
    showNotification('âš ï¸ è¯·å…ˆç”Ÿæˆæœ‰æ•ˆçš„è¯Šæ–­æŠ¥å‘Šå†å¯¼å‡ºï¼', 'warning');
    {% endif %}
}

// åˆ†äº«æŠ¥å‘Šï¼ˆæ¨¡æ‹ŸåŠŸèƒ½ï¼‰
function shareReport() {
    showNotification('ğŸ“¤ åˆ†äº«åŠŸèƒ½å³å°†ä¸Šçº¿ï¼Œè¯·å…ˆå¯¼å‡ºæŠ¥å‘Š', 'info');
}

// æ˜¾ç¤ºé€šçŸ¥
function showNotification(message, type = 'info') {
    // åˆ›å»ºé€šçŸ¥å…ƒç´ 
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#2563eb'};
        color: white;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
        white-space: pre-line;
    `;

    notification.textContent = message;
    document.body.appendChild(notification);

    // 3ç§’åç§»é™¤
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);

    // æ·»åŠ åŠ¨ç”»å…³é”®å¸§
    if (!document.getElementById('notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }
}

// é›·è¾¾å›¾æ¸²æŸ“
document.addEventListener('DOMContentLoaded', function() {
    {% if radar_data and radar_data.dimensions and radar_data.dimensions|length > 0 %}
    try {
        const radarChartDom = document.getElementById('radarChart');
        if (!radarChartDom) return;

        if (typeof echarts === 'undefined') {
            radarChartDom.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#94a3b8;font-size:14px;">ECharts åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢</div>';
            return;
        }

        const radarChart = echarts.init(radarChartDom);

        const dimensions = {{ radar_data.dimensions|tojson|safe }} || [];
        const jobWeights = {{ radar_data.job_weights|tojson|safe }} || [];
        const userWeights = {{ radar_data.user_weights|tojson|safe }} || [];

        // éªŒè¯æ•°æ®
        if (!dimensions || dimensions.length === 0 || !jobWeights || !userWeights) {
            radarChartDom.innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#94a3b8;text-align:center;"><div style="font-size:48px;margin-bottom:16px;">ğŸ“Š</div><div style="font-size:14px;">æš‚æ— æŠ€èƒ½æ•°æ®å¯ç”¨äºé›·è¾¾å›¾åˆ†æ</div></div>';
            return;
        }

        // ç¡®ä¿æ•°æ®é•¿åº¦ä¸€è‡´
        const maxLength = Math.max(dimensions.length, jobWeights.length, userWeights.length);
        const safeDimensions = dimensions.slice(0, maxLength);
        const safeJobWeights = jobWeights.slice(0, maxLength).map(w => w || 0);
        const safeUserWeights = userWeights.slice(0, maxLength).map(w => w || 0);

        const option = {
            tooltip: {
                trigger: 'item',
                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                borderColor: '#e2e8f0',
                borderWidth: 1,
                textStyle: {
                    color: '#334155',
                    fontSize: 12
                },
                formatter: function(params) {
                    let tooltipHtml = `<strong>${params.seriesName}</strong><br/>`;
                    params.value.forEach((val, index) => {
                        if (index < safeDimensions.length) {
                            const indicator = option.radar.indicator[index];
                            const color = params.seriesIndex === 0 ? '#2563eb' : '#10b981';
                            tooltipHtml += `<span style="color:${color};font-weight:500;">â—</span> ${indicator.name}: <strong>${val.toFixed(1)}</strong><br/>`;
                        }
                    });
                    return tooltipHtml;
                }
            },
            legend: {
                data: ['å²—ä½éœ€æ±‚', 'ä¸ªäººæŒæ¡'],
                bottom: 10,
                textStyle: {
                    fontSize: 12,
                    color: '#64748b'
                },
                itemGap: 20,
                itemWidth: 12,
                itemHeight: 12
            },
            radar: {
                indicator: safeDimensions.map((dim, index) => {
                    const maxVal = Math.max(10, Math.ceil(Math.max(safeJobWeights[index] || 0, safeUserWeights[index] || 0) * 1.2));
                    return {
                        name: dim || `æŠ€èƒ½${index+1}`,
                        max: maxVal
                    };
                }),
                shape: 'circle',
                splitNumber: 4,
                name: {
                    textStyle: {
                        fontSize: 12,
                        color: '#475569',
                        fontWeight: 500
                    }
                },
                splitLine: {
                    lineStyle: {
                        color: '#e2e8f0',
                        width: 1
                    }
                },
                splitArea: {
                    show: true,
                    areaStyle: {
                        color: ['rgba(248, 250, 252, 0.8)', 'rgba(255, 255, 255, 0.3)']
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: '#e2e8f0'
                    }
                }
            },
            series: [{
                name: 'æŠ€èƒ½åŒ¹é…',
                type: 'radar',
                data: [
                    {
                        value: safeJobWeights,
                        name: 'å²—ä½éœ€æ±‚',
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: {
                            width: 2,
                            color: '#2563eb'
                        },
                        itemStyle: {
                            color: '#2563eb'
                        },
                        areaStyle: {
                            color: 'rgba(37, 99, 235, 0.2)'
                        }
                    },
                    {
                        value: safeUserWeights,
                        name: 'ä¸ªäººæŒæ¡',
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: {
                            width: 2,
                            color: '#10b981'
                        },
                        itemStyle: {
                            color: '#10b981'
                        },
                        areaStyle: {
                            color: 'rgba(16, 185, 129, 0.2)'
                        }
                    }
                ]
            }]
        };

        radarChart.setOption(option);

        // å“åº”çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function() {
            radarChart.resize();
        });

    } catch (e) {
        console.error('é›·è¾¾å›¾æ¸²æŸ“å¤±è´¥ï¼š', e);
        const radarChartDom = document.getElementById('radarChart');
        if (radarChartDom) {
            radarChartDom.innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#94a3b8;text-align:center;"><div style="font-size:48px;margin-bottom:16px;">âš ï¸</div><div style="font-size:14px;">é›·è¾¾å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢</div></div>';
        }
    }
    {% endif %}
});
</script>
{% endblock %}